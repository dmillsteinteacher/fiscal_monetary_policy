<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policy Analysis: MLF & AS-AD Simulator V30 (Pure SVG)</title>
    <style>
        /* Basic styles for layout */
        body { font-family: 'Arial', sans-serif; background-color: #f0f4f8; padding: 20px; }
        .container { max-width: 1200px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        h1 { color: #004d99; text-align: center; border-bottom: 3px solid #004d99; padding-bottom: 15px; margin-bottom: 25px; }
        .graph-container { display: flex; justify-content: space-between; gap: 20px; margin-bottom: 40px; }
        .graph-wrapper { width: 50%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; background-color: #fff; }
        .policy-controls { padding: 20px; border: 1px solid #ff9900; border-radius: 8px; background-color: #fffaf0; margin-bottom: 20px;}
        .slider-group { margin-bottom: 25px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; color: #d9534f; }
        input[type=range] { width: 100%; }
        .policy-value { font-weight: bold; color: #007bff; }
        
        /* SVG-specific styles */
        .svg-axes { stroke: black; stroke-width: 2; }
        .curve { fill: none; stroke-width: 3; }
        .base-curve { stroke: gray; stroke-dasharray: 4; stroke-width: 1.5; }
        .mlf-d { stroke: red; }
        .mlf-s { stroke: blue; }
        .asad-d { stroke: red; }
        .asad-s { stroke: green; }
        .asad-lras { stroke: purple; stroke-dasharray: 2; }
        .equilibrium-point { fill: black; }
        .base-point { fill: green; }
        .label-r { fill: red; }
        .label-q { fill: blue; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Policy Analysis: MLF & AS-AD Simulator V30 (Pure SVG)</h1>

        <div class="policy-controls">
            <h2>Policy Simulation Controls ðŸ§ª</h2>

            <div class="slider-group">
                <label for="fiscalPolicy">Fiscal Policy ($\text{G}$ / $\text{T}$ Shift): <span id="fiscalValue" class="policy-value">0</span></label>
                <input type="range" id="fiscalPolicy" min="-15" max="15" value="0" step="1" oninput="updateGraphs()">
            </div>
            <div class="slider-group">
                <label for="monetaryPolicy">Monetary Policy ($\text{M}$ Shift): <span id="monetaryValue" class="policy-value">0</span></label>
                <input type="range" id="monetaryPolicy" min="-15" max="15" value="0" step="1" oninput="updateGraphs()">
            </div>
        </div>

        <div class="graph-container">
            <div class="graph-wrapper">
                <h3>Loanable Funds Market (MLF)</h3>
                <svg id="mlfGraph" width="100%" height="400" viewBox="0 0 450 400"></svg>
            </div>
            <div class="graph-wrapper">
                <h3>Aggregate Demand - Supply (AS-AD)</h3>
                <svg id="asadGraph" width="100%" height="400" viewBox="0 0 450 400"></svg>
            </div>
        </div>
        
    </div>

    <script>
        // --- Core Economic Constants V29 (Corrected) ---
        const EQ_R = 5;       // Initial Real Interest Rate (%)
        const EQ_PL = 100;    // Initial Price Level
        const EQ_RGDP = 500;  // Initial Real GDP
        const SLOPE_D = 0.5;  // Demand slope
        const SLOPE_S = 0.5;  // Supply slope
        const SUM_SLOPES = SLOPE_D + SLOPE_S;

        // CRITICAL ECONOMIC CONSTANTS (Ensures Fiscal effect > Crowding Out)
        const AD_SENSITIVITY = 2.0; 
        const FISCAL_MULTIPLIER = 3.0; 
        const AD_TO_SRAS_RATIO = 0.25; 
        const PLOT_POINTS = 50; 
        
        // --- SVG CONFIGURATION ---
        const SVG_PADDING = 50;
        const SVG_WIDTH = 450;
        const SVG_HEIGHT = 400;
        const GRAPH_WIDTH = SVG_WIDTH - 2 * SVG_PADDING;
        const GRAPH_HEIGHT = SVG_HEIGHT - 2 * SVG_PADDING;

        // Domain/Range Mappings (Data to SVG Coordinates)
        const R_MIN = 1, R_MAX = 9;
        const Q_MIN = 50, Q_MAX = 150;
        const PL_MIN = 80, PL_MAX = 120;
        const RGDP_MIN = 400, RGDP_MAX = 600;
        const LRAS_VAL = 550; // Long Run RGDP for LRAS line

        function toX(dataX, dataMin, dataMax) {
            return SVG_PADDING + (dataX - dataMin) * GRAPH_WIDTH / (dataMax - dataMin);
        }
        function toY(dataY, dataMin, dataMax) {
            // Y-axis inversion for SVG
            return SVG_HEIGHT - SVG_PADDING - (dataY - dataMin) * GRAPH_HEIGHT / (dataMax - dataMin);
        }

        // --- 1. MLF Graphing ---
        function getMLFCurvePoints(shift, isDemand, rMin, rMax) {
            let pathD = "";
            for (let i = 0; i < PLOT_POINTS; i++) {
                const r = rMin + (rMax - rMin) * (i / (PLOT_POINTS - 1));
                let q;
                if (isDemand) {
                    q = EQ_Q + (EQ_R - r) / SLOPE_D + shift;
                } else {
                    q = EQ_Q + (r - EQ_R) / SLOPE_S + shift;
                }
                const x = toX(q, Q_MIN, Q_MAX);
                const y = toY(r, R_MIN, R_MAX);
                pathD += (i === 0 ? "M" : "L") + x + "," + y + " ";
            }
            return pathD;
        }
        
        function calculateMLFEquilibrium(fiscalShift, monetaryShift) {
            const r_new = EQ_R + AD_TO_SRAS_RATIO * (fiscalShift - monetaryShift);
            const q_new = EQ_Q + (SLOPE_S * fiscalShift + SLOPE_D * monetaryShift) / SUM_SLOPES;
            return { r_new, q_new };
        }

        function drawMLFGraph(fiscalShift, monetaryShift) {
            const svg = document.getElementById('mlfGraph');
            svg.innerHTML = ''; // Clear previous drawing
            const { r_new, q_new } = calculateMLFEquilibrium(fiscalShift, monetaryShift);
            
            // Draw Axes
            svg.innerHTML += `<line x1="${toX(Q_MIN, Q_MIN, Q_MAX)}" y1="${toY(R_MIN, R_MIN, R_MAX)}" x2="${toX(Q_MAX, Q_MIN, Q_MAX)}" y2="${toY(R_MIN, R_MIN, R_MAX)}" class="svg-axes" />`;
            svg.innerHTML += `<line x1="${toX(Q_MIN, Q_MIN, Q_MAX)}" y1="${toY(R_MIN, R_MIN, R_MAX)}" x2="${toX(Q_MIN, Q_MIN, Q_MAX)}" y2="${toY(R_MAX, R_MIN, R_MAX)}" class="svg-axes" />`;

            // Axis Labels
            svg.innerHTML += `<text x="${SVG_WIDTH / 2}" y="${SVG_HEIGHT - 5}" text-anchor="middle">Quantity of LF (Q)</text>`;
            svg.innerHTML += `<text x="5" y="${SVG_HEIGHT / 2}" transform="rotate(-90, 5, ${SVG_HEIGHT / 2})" text-anchor="middle">Real Interest Rate (r)</text>`;
            
            // Base Curves
            svg.innerHTML += `<path d="${getMLFCurvePoints(0, true, R_MIN, R_MAX)}" class="curve base-curve" />`; // DLF Base
            svg.innerHTML += `<path d="${getMLFCurvePoints(0, false, R_MIN, R_MAX)}" class="curve base-curve" />`; // SLF Base

            // New Curves
            svg.innerHTML += `<path d="${getMLFCurvePoints(fiscalShift, true, R_MIN, R_MAX)}" class="curve mlf-d" />`; // DLF'
            svg.innerHTML += `<path d="${getMLFCurvePoints(monetaryShift, false, R_MIN, R_MAX)}" class="curve mlf-s" />`; // SLF'

            // Equilibrium Points (E0)
            const x0 = toX(EQ_Q, Q_MIN, Q_MAX);
            const y0 = toY(EQ_R, R_MIN, R_MAX);
            svg.innerHTML += `<circle cx="${x0}" cy="${y0}" r="5" class="base-point" />`;
            svg.innerHTML += `<text x="${x0 + 10}" y="${y0 - 10}">E0 (${EQ_R.toFixed(2)}%)</text>`;

            // New Equilibrium Point (E1)
            const x1 = toX(q_new, Q_MIN, Q_MAX);
            const y1 = toY(r_new, R_MIN, R_MAX);
            svg.innerHTML += `<circle cx="${x1}" cy="${y1}" r="5" class="equilibrium-point" />`;
            svg.innerHTML += `<text x="${x1 + 10}" y="${y1 - 10}" class="label-r">E1 (${r_new.toFixed(2)}%)</text>`;
        }

        // --- 2. AS-AD Graphing ---

        function getASADCurvePoints(shift, isDemand, plMin, plMax) {
            let pathD = "";
            for (let i = 0; i < PLOT_POINTS; i++) {
                const pl = plMin + (plMax - plMin) * (i / (PLOT_POINTS - 1));
                let rgdp;
                if (isDemand) {
                    rgdp = EQ_RGDP + (EQ_PL - pl) / SLOPE_D + shift;
                } else { // SRAS
                    rgdp = EQ_RGDP + (pl - EQ_PL) / SLOPE_S;
                }
                const x = toX(rgdp, RGDP_MIN, RGDP_MAX);
                const y = toY(pl, PL_MIN, PL_MAX);
                pathD += (i === 0 ? "M" : "L") + x + "," + y + " ";
            }
            return pathD;
        }

        function calculateASADEquilibrium(r_new, fiscalShift) {
            // 1. Direct Fiscal Effect
            const direct_fiscal_effect = fiscalShift * FISCAL_MULTIPLIER;
            // 2. Crowding-Out/In Effect
            const r_change = r_new - EQ_R; 
            const crowding_effect = (EQ_R - r_new) * AD_SENSITIVITY; 
            
            // Total AD Shift
            const ad_shift = direct_fiscal_effect + crowding_effect;
            
            // AS-AD Intersection
            const pl_new = EQ_PL + AD_TO_SRAS_RATIO * ad_shift;
            const rgdp_new = EQ_RGDP + (pl_new - EQ_PL) / SLOPE_S;

            return { pl_new, rgdp_new, r_change, ad_shift };
        }

        function drawASADGraph(r_new, fiscalShift) {
            const svg = document.getElementById('asadGraph');
            svg.innerHTML = ''; // Clear previous drawing
            const { pl_new, rgdp_new, r_change, ad_shift } = calculateASADEquilibrium(r_new, fiscalShift);
            
            // Draw Axes
            svg.innerHTML += `<line x1="${toX(RGDP_MIN, RGDP_MIN, RGDP_MAX)}" y1="${toY(PL_MIN, PL_MIN, PL_MAX)}" x2="${toX(RGDP_MAX, RGDP_MIN, RGDP_MAX)}" y2="${toY(PL_MIN, PL_MIN, PL_MAX)}" class="svg-axes" />`;
            svg.innerHTML += `<line x1="${toX(RGDP_MIN, RGDP_MIN, RGDP_MAX)}" y1="${toY(PL_MIN, PL_MIN, PL_MAX)}" x2="${toX(RGDP_MIN, RGDP_MIN, RGDP_MAX)}" y2="${toY(PL_MAX, PL_MIN, PL_MAX)}" class="svg-axes" />`;
            
            // Axis Labels
            svg.innerHTML += `<text x="${SVG_WIDTH / 2}" y="${SVG_HEIGHT - 5}" text-anchor="middle">Real GDP (RGDP)</text>`;
            svg.innerHTML += `<text x="5" y="${SVG_HEIGHT / 2}" transform="rotate(-90, 5, ${SVG_HEIGHT / 2})" text-anchor="middle">Price Level (PL)</text>`;
            
            // SRAS and LRAS
            svg.innerHTML += `<path d="${getASADCurvePoints(0, false, PL_MIN, PL_MAX)}" class="curve asad-s" />`; // SRAS
            svg.innerHTML += `<line x1="${toX(LRAS_VAL, RGDP_MIN, RGDP_MAX)}" y1="${toY(PL_MIN, PL_MIN, PL_MAX)}" x2="${toX(LRAS_VAL, RGDP_MIN, RGDP_MAX)}" y2="${toY(PL_MAX, PL_MIN, PL_MAX)}" class="asad-lras" />`; // LRAS (Vertical line)

            // Base AD Curve
            svg.innerHTML += `<path d="${getASADCurvePoints(0, true, PL_MIN, PL_MAX)}" class="curve base-curve" />`; // AD Base

            // New AD Curve
            svg.innerHTML += `<path d="${getASADCurvePoints(ad_shift, true, PL_MIN, PL_MAX)}" class="curve asad-d" />`; // AD'

            // Equilibrium Points (E0)
            const x0 = toX(EQ_RGDP, RGDP_MIN, RGDP_MAX);
            const y0 = toY(EQ_PL, PL_MIN, PL_MAX);
            svg.innerHTML += `<circle cx="${x0}" cy="${y0}" r="5" class="base-point" />`;
            svg.innerHTML += `<text x="${x0 - 20}" y="${y0 - 10}">E0</text>`;

            // New Equilibrium Point (E1)
            const x1 = toX(rgdp_new, RGDP_MIN, RGDP_MAX);
            const y1 = toY(pl_new, PL_MIN, PL_MAX);
            svg.innerHTML += `<circle cx="${x1}" cy="${y1}" r="5" class="equilibrium-point" />`;
            svg.innerHTML += `<text x="${x1 + 10}" y="${y1 - 10}">E1</text>`;

            // Output Analysis
            let lras_text = '';
            let lras_class = 'lras-neutral';

            if (r_change > 0.1) {
                lras_text = `LRAS: Slowing (Crowding Out, r $\uparrow$ by ${r_change.toFixed(2)}%)`;
                lras_class = 'lras-negative';
            } else if (r_change < -0.1) {
                lras_text = `LRAS: Boosting (Crowding In, r $\downarrow$ by ${Math.abs(r_change).toFixed(2)}%)`;
                lras_class = 'lras-positive';
            } else {
                lras_text = 'LRAS: Neutral';
                lras_class = 'lras-neutral';
            }
            
            svg.innerHTML += `<text x="${SVG_WIDTH / 2}" y="${SVG_HEIGHT - 30}" text-anchor="middle" class="${lras_class}">${lras_text}</text>`;
        }

        // --- 3. Update Function ---

        function updateGraphs() {
            const fiscalPolicyValue = parseFloat(document.getElementById('fiscalPolicy').value);
            const monetaryPolicyValue = parseFloat(document.getElementById('monetaryPolicy').value);

            document.getElementById('fiscalValue').textContent = fiscalPolicyValue;
            document.getElementById('monetaryValue').textContent = monetaryPolicyValue;

            const mlf_results = calculateMLFEquilibrium(fiscalPolicyValue, monetaryPolicyValue);
            drawMLFGraph(fiscalPolicyValue, monetaryPolicyValue);
            
            drawASADGraph(mlf_results.r_new, fiscalPolicyValue);
        }
        
        // Initial Draw
        window.onload = updateGraphs;
    </script>

</body>
</html>
