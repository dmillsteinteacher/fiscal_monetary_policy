<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Policy Analysis: MLF & AS-AD Simulator V10 (Layering Fix)</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        /* CSS for a clean, educational layout */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        h1 {
            color: #004d99;
            text-align: center;
            border-bottom: 3px solid #004d99;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        h2 {
            color: #28a745;
            margin-top: 30px;
        }
        h3 {
            color: #0056b3;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .graph-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 40px;
        }
        .graph {
            width: 50%;
            height: 450px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #fff;
        }
        .policy-controls {
            padding: 20px;
            border: 1px solid #ff9900;
            border-radius: 8px;
            background-color: #fffaf0;
        }
        .slider-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #d9534f;
        }
        input[type=range] {
            width: 100%;
        }
        .policy-value {
            font-weight: bold;
            color: #007bff;
        }
        ul.flaws-list {
            list-style: none;
            padding-left: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        ul.flaws-list li {
            background-color: #ffe0b2;
            padding: 15px;
            border-radius: 6px;
            width: calc(50% - 10px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .combo-objective {
            background-color: #e3f2fd;
            padding: 15px;
            border-left: 5px solid #2196f3;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Policy Analysis: Loanable Funds (MLF) and AS-AD Graphs</h1>

        <div class="policy-controls">
            <h2>Policy Simulation Controls ðŸ§ª</h2>

            <div class="slider-group">
                <label for="fiscalPolicy">Fiscal Policy (Government Deficit/Surplus): <span id="fiscalValue" class="policy-value">0</span></label>
                <input type="range" id="fiscalPolicy" min="-15" max="15" value="0" step="1" oninput="updateGraphs()">
                <small>Negative = Contractionary (DLF shifts Left); Positive = Expansionary (DLF shifts Right)</small>
            </div>

            <div class="slider-group">
                <label for="monetaryPolicy">Monetary Policy (Money Supply Change): <span id="monetaryValue" class="policy-value">0</span></label>
                <input type="range" id="monetaryPolicy" min="-15" max="15" value="0" step="1" oninput="updateGraphs()">
                <small>Negative = Contractionary (SLF shifts Left); Positive = Expansionary (SLF shifts Right)</small>
            </div>
        </div>

        <div class="graph-container">
            <div id="mlfGraph" class="graph"></div>
            <div id="asadGraph" class="graph"></div>
        </div>
        
        <section>
            <h2>Policy Commentary and Flaws</h2>
            <p>Use the sliders above to model the policies and observe the mechanical shifts. The **flaws** listed below explain why policymakers often hesitate to use these tools alone.</p>

            <h3 id="standalone-flaws">Standalone Policy Flaws</h3>
            <ul class="flaws-list">
                <li>
                    <strong>XFP (Expansionary Fiscal Policy) Flaw:</strong>
                    The **Crowding-Out Effect**. Government borrowing to fund the deficit increases **r** in the MLF, which reduces (crowds out) private Investment (**I**). This means slower long-run growth (slower rightward shift of LRAS).
                </li>
                <li>
                    <strong>CFP (Contractionary Fiscal Policy) Flaw:</strong>
                    **Implementation Lag**. Enacting tax and spending changes requires lengthy debate and legislative approval (Congress), which means the policy takes effect very slowly.
                </li>
                <li>
                    <strong>XMP (Expansionary Monetary Policy) Flaw:</strong>
                    **Impact Lag**. The Fed's actions immediately affect short-term rates, but it takes a long and variable time (6-18 months) for these changes to fully filter through the banking system to affect **I** and **C**, thus shifting **AD**.
                </li>
                <li>
                    <strong>CMP (Contractionary Monetary Policy) Flaw:</strong>
                    **Slowed Long-Run Growth**. The policy successfully raises **r** to cool inflation, but this higher rate also deters private Investment (**I**), slowing the growth of the economy's capital stock and the future LRAS.
                </li>
            </ul>

            <h3 id="combo-objectives">Combination Policy Objectives (The Synergy)</h3>
            <div class="combo-objective">
                <h4>Combo #1: XFP + XMP ("Obama")</h4>
                <p><strong>Goal:</strong> Stimulate **AD** (double push right) while **neutralizing the crowding-out effect**. The SLF shift (XMP) counteracts the rise in **r** caused by the DLF shift (XFP), making the fiscal stimulus far more effective without sacrificing future growth.</p>
            </div>
            <div class="combo-objective">
                <h4>Combo #2: CFP + CMP ("Truman")</h4>
                <p><strong>Goal:</strong> Cool the economy by shifting **AD** left while **neutralizing the "crowding-in" effect**. The SLF shift (CMP) prevents **r** from falling too much, which would otherwise encourage a counter-productive boom in private Investment.</p>
            </div>
        </section>
    </div>

    <script>
        // --- Core Graphing Logic (JavaScript) ---

        // Constants for initial equilibrium and graph range
        const EQ_R = 5;      // Initial Real Interest Rate (r)
        const EQ_Q = 100;    // Initial Quantity of Loanable Funds (QLF)
        const EQ_PL = 100;   // Initial Price Level (PL)
        const EQ_RGDP = 500; // Initial Real GDP (rgdp)
        const SLOPE_D = 0.5; // Slope for Demand (DLF/AD)
        const SLOPE_S = 0.5; // Slope for Supply (SLF/AS)
        const MAX_RGDP = 550; // For Long-Run Aggregate Supply (LRAS)

        let mlfLayout = {};
        let asadLayout = {};
        
        // --- 1. Loanable Funds Market (MLF) Functions ---
        
        function getMLFCurve(r, shift, isDemand) {
            let q = [];
            for (let i = 0; i < r.length; i++) {
                if (isDemand) {
                    q.push(EQ_Q + (EQ_R - r[i]) / SLOPE_D + shift);
                } else {
                    q.push(EQ_Q + (r[i] - EQ_R) / SLOPE_S + shift);
                }
            }
            return q;
        }

        function createMLFGraph(fiscalShift, monetaryShift) {
            const r_range = Array.from({ length: 41 }, (_, i) => 1 + i * 0.2); // r from 1 to 9
            
            // Calculate Base Curves (shift = 0)
            const dlf_base = getMLFCurve(r_range, 0, true);
            const slf_base = getMLFCurve(r_range, 0, false);

            // Calculate Shifted Curves
            const dlf_new = getMLFCurve(r_range, fiscalShift, true);
            const slf_new = getMLFCurve(r_range, monetaryShift, false); 

            // Calculate the new equilibrium (r_new, q_new)
            const s_avg = (SLOPE_D + SLOPE_S) / 2;
            const r_new = EQ_R + s_avg * (fiscalShift - monetaryShift);
            const q_new = EQ_Q + (r_new - EQ_R) / SLOPE_S + monetaryShift;

            const traces = [
                // 1. Base DLF/SLF Curves (light gray, dashed) - for reference
                { x: dlf_base, y: r_range, mode: 'lines', name: 'DLF (Base)', line: { dash: 'dash', color: 'gray', width: 1 }, showlegend: false, hoverinfo: 'none' },
                { x: slf_base, y: r_range, mode: 'lines', name: 'SLF (Base)', line: { dash: 'dash', color: 'gray', width: 1 }, showlegend: false, hoverinfo: 'none' },

                // 2. New Curves (solid, bold) - BOTH LINES ARE BACK
                { x: dlf_new, y: r_range, mode: 'lines', name: 'DLF\' (Fiscal)', line: { color: 'red', width: 3 } },
                { x: slf_new, y: r_range, mode: 'lines', name: 'SLF\' (Monetary)', line: { color: 'blue', width: 3 } },
                
                // 3. Equilibrium Path Tracer (Path must show the diagonal jump)
                { x: [EQ_Q, q_new], y: [EQ_R, r_new], mode: 'lines', name: 'Eq Path', line: { dash: 'dot', color: 'black', width: 2 }, showlegend: false, hoverinfo: 'none' },

                // 4. Initial Equilibrium Point (E0)
                { x: [EQ_Q], y: [EQ_R], mode: 'markers', name: 'E<sub>0</sub>', marker: { size: 10, color: 'green', symbol: 'circle' }, showlegend: false },
                
                // 5. New Equilibrium Point (E1) - THE MOVING DOT - Plotted last to ensure it's on top
                { x: [q_new], y: [r_new], mode: 'markers', name: 'E<sub>1</sub> (New Eq)', marker: { size: 10, color: 'black', symbol: 'diamond' } }
            ];

            mlfLayout = {
                title: 'Loanable Funds Market (MLF)',
                xaxis: { title: 'Quantity of Loanable Funds (QLF)', range: [50, 150] },
                yaxis: { title: 'Real Interest Rate (r)', range: [1, 9] },
                showlegend: true,
                legend: { x: 1.05, y: 0.9, xanchor: 'left' },
                annotations: [
                    { x: EQ_Q, y: EQ_R, text: 'E<sub>0</sub>', showarrow: true, arrowhead: 1, ax: -30, ay: -30 } 
                ]
            };

            Plotly.newPlot('mlfGraph', traces, mlfLayout, { displayModeBar: false });
            return { r_new: r_new, q_new: q_new };
        }

        // --- 2. Aggregate Supply-Aggregate Demand (AS-AD) Functions ---
        
        function getADCurve(pl, shift) {
            let rgdp = [];
            for (let i = 0; i < pl.length; i++) {
                rgdp.push(EQ_RGDP + (EQ_PL - pl[i]) / SLOPE_D + shift);
            }
            return rgdp;
        }

        function getSRASCurve(pl) {
            let rgdp = [];
            for (let i = 0; i < pl.length; i++) {
                rgdp.push(EQ_RGDP + (pl[i] - EQ_PL) / SLOPE_S);
            }
            return rgdp;
        }

        function createASADGraph(r_new) {
            const pl_range = Array.from({ length: 41 }, (_, i) => 80 + i * 1); // PL from 80 to 120

            // AD Shift is based on the change in r. Lower r shifts AD right.
            const AD_SENSITIVITY = 5; 
            const ad_shift = (EQ_R - r_new) * AD_SENSITIVITY; 

            // Calculate Base AD Curve
            const ad_base = getADCurve(pl_range, 0); 

            // Calculate SRAS and LRAS (Static)
            const sras_base = getSRASCurve(pl_range);
            
            // Calculate New AD Curve
            const ad_new = getADCurve(pl_range, ad_shift);

            // Calculate new AS-AD equilibrium (PL_new, RGDP_new)
            const s_avg = (SLOPE_D + SLOPE_S) / 2;
            const pl_new = EQ_PL + s_avg * ad_shift;
            const rgdp_new = EQ_RGDP + (pl_new - EQ_PL) / SLOPE_S;

            const traces = [
                // 1. Base AD Curve (light gray, dashed) - for reference
                { x: ad_base, y: pl_range, mode: 'lines', name: 'AD (Base)', line: { dash: 'dash', color: 'gray', width: 1 }, showlegend: false, hoverinfo: 'none' },

                // 2. SRAS and LRAS (Static)
                { x: sras_base, y: pl_range, mode: 'lines', name: 'SRAS', line: { color: 'green', width: 3 } },
                { x: Array(pl_range.length).fill(MAX_RGDP), y: pl_range, mode: 'lines', name: 'LRAS (Potential)', line: { dash: 'dot', color: 'purple' }, hoverinfo: 'none' },
                
                // 3. New AD Curve (solid)
                { x: ad_new, y: pl_range, mode: 'lines', name: 'AD\'', line: { color: 'red', width: 3 } },
                
                // 4. Equilibrium Path Tracer (Visualizing the move along SRAS)
                { x: [EQ_RGDP, rgdp_new], y: [EQ_PL, pl_new], mode: 'lines', name: 'Eq Path', line: { dash: 'dot', color: 'black', width: 2 }, showlegend: false, hoverinfo: 'none' },

                // 5. Initial Equilibrium Point (E0)
                { x: [EQ_RGDP], y: [EQ_PL], mode: 'markers', name: 'E<sub>0</sub>', marker: { size: 10, color: 'green', symbol: 'circle' }, showlegend: false },

                // 6. New Equilibrium Point (E1) - THE MOVING DOT
                { x: [rgdp_new], y: [pl_new], mode: 'markers', name: 'E<sub>1</sub> (New Eq)', marker: { size: 10, color: 'black', symbol: 'diamond' } }
            ];

            asadLayout = {
                title: 'Aggregate Demand - Aggregate Supply (AS-AD)',
                xaxis: { title: 'Real GDP (rgdp)', range: [400, 600] },
                yaxis: { title: 'Price Level (PL)', range: [80, 120] },
                showlegend: true,
                legend: { x: 1.05, y: 0.9, xanchor: 'left' },
                annotations: [
                    { x: EQ_RGDP, y: EQ_PL, text: 'E<sub>0</sub>', showarrow: true, arrowhead: 1, ax: -30, ay: -30 }
                ]
            };

            Plotly.newPlot('asadGraph', traces, asadLayout, { displayModeBar: false });
        }

        // --- 3. Update Function (Called by Sliders) ---

        function updateGraphs() {
            const fiscalPolicyValue = parseFloat(document.getElementById('fiscalPolicy').value);
            const monetaryPolicyValue = parseFloat(document.getElementById('monetaryPolicy').value);

            // Update display values
            document.getElementById('fiscalValue').textContent = fiscalPolicyValue;
            document.getElementById('monetaryValue').textContent = monetaryPolicyValue;

            // Step 1: Update MLF Graph and get the new Real Interest Rate (r')
            const mlf_results = createMLFGraph(fiscalPolicyValue, monetaryPolicyValue);
            
            // Step 2: Use the new Real Interest Rate (r') to update the AS-AD Graph
            createASADGraph(mlf_results.r_new);
        }
        
        // Initial setup call
        document.addEventListener('DOMContentLoaded', updateGraphs);
    </script>

</body>
</html>
